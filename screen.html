<html>
<head>
    <link href="fonts/customfont.css?version=1" rel="stylesheet"/>

    <script src="jquery-1.11.3.min.js"></script>
    <script src="lawnchair.js"></script>
    <script src="encoder.js"></script>

    <script type='text/javascript' src="adapters/dom.js"></script>
    <script type='text/javascript' src="adapters/webkit-sqlite.js"></script>


    <style>
	    .text-object {
		//TODO bert.. look at this does it break? 
		 -webkit-transform: translate3d(0, 0, 1px);
		}
        .visible {
            visibility: visible;
            opacity: 1;
            transition: opacity 2s linear;
        }

        .hidden {
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s 2s, opacity 2s linear;
        }

        .hiddenimd {
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s 0s, opacity 0s linear;
        }
		.visibleimd {
		    visibility: visible;
            opacity: 1;
            transition: visibility 0s 0s, opacity 0s linear;
		}
		#topContainer{
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			
		}
		
        .rotate90 {
		
		
		
            -moz-transform-origin: 0 0;
            -ms-transform-origin: 0 0;
            -o-transform-origin: 0 0;
            -webkit-transform-origin: 0 0;
            transform-origin: 0 0;
            -ms-transform: rotate(90deg); /* IE 9 */
            -webkit-transform: rotate(90deg); /* Safari and Chrome */
            -moz-transform: rotate(90deg);
            -o-transform: rotate(90deg);
            transform: rotate(90deg);
			
			
		
		
			
			
        }

        .rotate180 {
            -moz-transform-origin: 50% 50%;
            -ms-transform-origin: 50% 50%;
            -o-transform-origin: 50% 50%;
            -webkit-transform-origin: 50% 50%;
            transform-origin: 50% 50%;
            -ms-transform: rotate(180deg); /* IE 9 */
            -webkit-transform: rotate(180deg); /* Safari and Chrome */
            -moz-transform: rotate(180deg);
            -o-transform: rotate(180deg);
            transform: rotate(180deg);
        }

        .rotate270 {
            -moz-transform-origin: 0 0;
            -ms-transform-origin: 0 0;
            -o-transform-origin: 0 0;
            -webkit-transform-origin: 0 0;
            transform-origin: 0 0;
            -ms-transform: rotate(270deg); /* IE 9 */
            -webkit-transform: rotate(270deg); /* Safari and Chrome */
            -moz-transform: rotate(270deg);
            -o-transform: rotate(270deg);
            transform: rotate(270deg);
        }
    </style>

</head>
<body>
<input type='text' id='data' value="7th data" style="display:none"><input type="submit" style="display:none" value="updateContent(data)" onClick="updateContent(document.getElementById('data').value);">
<div id="topContainer">
	<div id="viewport" style="left:0;top:0;display:block;height:100%;width:100%;position:absolute;background-color:transparent;z-index:15;overflow:hidden;"></div>
	<div id="viewportmaster" style="left:0;top:0;display:block;height:100%;width:100%;position:absolute;background-color:transparent;z-index:5;overflow:hidden"></div>

	<div id="prerender" style="display:block;height:0;width:0;position:absolute;background-color:transparent;border:1px solid black;margin-top:500px;overflow:hidden"></div>
	<div id="prerendermaster" style="display:block;height:0;width:0;position:absolute;border:1px solid black;margin-top:500px;overflow:hidden"></div>
</div>
<div id="console" style="display:none">Console:</div>

<script>
//OSSNH
//ONS
//JGD
Lawnchair(function() {
         this.nuke();
        console.log("nuked");
	});
	
Lawnchair( function() {
this.keys( function(key) {
this.remove(key);})
});

window.localStorage.clear();

var slides = new Lawnchair({name: "slides"}, function(){});

var masterslides = new Lawnchair({name: "masterslides"}, function(){});

var playlists = new Lawnchair({name: "playlists"}, function(){});

var schedules;
var defaultpl="";
var override="";
var currentplaylist ="";
var currentslide="";
var playlistcounter = 0;
var globalPlayJson;
var currentmasterslide="";
var currentschedule="";
var slideTimer;
var effectTimer;
var clearScreenTimer;
var slideCounter=0;
var listcounter;
var listplaystring;
var mmddyyyysec;
var defaultmode = false;
var overridemode = false;
var days = ['sunday','monday','tuesday','wednesday','thursday','friday','saturday'];

var CANVAS_WIDTH, CANVAS_HEIGHT;
var CANVAS_O_WIDTH = 1920;
var CANVAS_O_HEIGHT = 1080;
var CANVAS_ASPECT_RATIO = CANVAS_O_WIDTH / CANVAS_O_HEIGHT;

var topContainer;

var listplaylist = [];
var isFlipped = false;
var bNativeVideos = true;


ucArr = [];

//
// Placeholders video callbacks to host
// Android.stopAllVideos(){};
// Android.playAllVideos(aVideoElements) {};


ucExec = false;
function updateContentClass(data) {
    this.data = data;
    this.runner = function() {
	    
        document.getElementById('console').innerHTML = document.getElementById('console').innerHTML + "</br>" + (this.data);
		
		var json = eval("(" + data + ")");
		console.log("updateContent");
		console.log(json);
		json.key = json.id;
		
		if(json.type == "playlist"){
			//console.log('in pl add ' + json.id);
			if(json.slides){
				//console.log('pl slides found');
				playlists.save(json, function(obj){
				if(currentplaylist == json.id){
					
					renderPlayList(json);
				}
				ucThreadNext();});
				
			} else {
				playlists.remove(json.key, function(){  console.log('removed');ucThreadNext(); });
			}
		}
		if(json.type == "slide"){
			if(json.elements){
				slides.save(json, function(obj){console.log(obj);ucThreadNext();});
			} else {
				slides.save(json, function(obj){console.log(obj);
					//console.log(json.key);
					//alert("slides."+json.key);
					//window.localStorage.clear("slides."+json.key);
					
				slides.remove(json.key + "", function(){ console.log('removed slide') });
				if(currentslide == json.key) {
					//slideCounter++;
					//console.log("slideCounter==globalPlayJson.slides.length"+slideCounter+"=="+globalPlayJson.slides.length);
				    //alert('same slide');
					
					//if(slideCounter==globalPlayJson.slides.length){slideCounter=0;alert("counter 0"); rotatePlArray();return; /*console.log("resetting");*/}
					renderPlayList(globalPlayJson);
					
				}
				ucThreadNext();
				});
				

			}
		}
		if(json.type == "master-slide"){
			//console.log(json);
			masterslides.save(json, function(obj){console.log(obj);ucThreadNext();});
			if(json.elements){
				masterslides.save(json, function(obj){console.log(obj);ucThreadNext();});
			} else {
				masterslides.remove(json.key + "", function(){ console.log('removed mslide');ucThreadNext(); });
			}
		}
		if(json.type == "schedule"){
		  schedules = json;
		  ucThreadNext();
		}
		if(json.type == "default"){
			//alert("received defult");
			if(json.playlistId) {
				defaultpl = json;
				if(defaultmode){
					//alert("starting default from load");
					startPlayList(json.playlistId, 0);
				}
			} else {
				defaultpl = "";
				if(defaultmode){
					cleanUp();
					cleanListplaylist();
					clearTimeout(slideTimer);
					clearTimeout(effectTimer);
					listplaystring = "";
					currentplaylist = "";
				}
			}
			ucThreadNext();
		}
		if(json.type == "override"){
		  override = json;
		  //console.log(override);
		  //alert("received override");
		  if(override.playlistId){
			//alert(override.playlistId +" " +override.end +" " + mmddyyyysec);
			//alert((Date.parse(mmddyyyysec) < Date.parse(override.end)));
			if((Date.parse(mmddyyyysec) < Date.parse(override.end))){
				cleanUp();
				cleanListplaylist();
				currentplaylist = override.playlistId;
				defaultmode = false;
				overridemode = true;
				//alert("starting override");
				startPlayList(override.playlistId, 0);
			}
		  } else {
			//alert("cleaning override");
			override = "";
			
			if(overridemode){
				cleanUp();
				cleanListplaylist();
				clearTimeout(slideTimer);
				listplaystring = "";
				currentplaylist = "";
				//alert(currentplaylist.length);
			}
			overridemode = false;
		  }
		  ucThreadNext();
		}

    };
}
function refreshPlaylistArr(){
	cleanListplaylist();
	var now = new Date();
	var d =  Date.UTC(now.getUTCFullYear(),now.getUTCMonth(), now.getUTCDay() , 
      now.getUTCHours(), now.getUTCMinutes(), now.getUTCSeconds(), now.getUTCMilliseconds());
	var day = days[now.getUTCDay()].toLowerCase();
	
		var month = now.getUTCMonth();
		if (month < 10) {
			month = "0" + month;
		}
		var numday = now.getUTCDay();
		if (numday < 10) {
			numday = "0" + numday;
		}
		var hr = now.getUTCHours();
		var min = now.getUTCMinutes();
		if (min < 10) {
			min = "0" + min;
		}
		var sec = now.getUTCSeconds();
		if (sec < 10) {
			sec = "0" + sec;
		}
		var ampm = hr < 12 ? "am" : "pm";
		//var mmddyyyysec = (month) + '/' + numday + '/' +  now.getUTCFullYear() +" "+ hr + ":" + min + ":" + sec ;
		if (hr > 12 ){
			hr = hr-12;
		}
		if (hr < 10) {
			hr = "0" + hr;
		}
		
		
		var date = now.getUTCDate();
		var format = hr+":"+min+":"+sec+" "+ampm;
	try{
			for(j=0;j<schedules.playlists.length;j++) {
				
				if ((now.getUTCDay() > days.indexOf(schedules.playlists[j].start.weekDay) )|| (day === schedules.playlists[j].start.weekDay && (convertToTimeStamp(now.getUTCDay(), format) == convertToTimeStamp( days.indexOf(schedules.playlists[j].start.weekDay),schedules.playlists[j].start.time) || convertToTimeStamp(now.getUTCDay(), format) > convertToTimeStamp(days.indexOf(schedules.playlists[j].start.weekDay), schedules.playlists[j].start.time)))) {
					var numday = days.indexOf(schedules.playlists[j].end.weekDay);
					/*
					if(numday - now.getUTCDay() < 0) {numday = numday + 7;}
					if(day == schedules.playlists[j].end.weekDay) {
						if(convertToTimeStamp(now.getUTCDay() , format) < convertToTimeStamp(numday, schedules.playlists[j].end.time)) {
							//console.log("inside second if");
							listplaylist.push(schedules.playlists[j].id);
						} 
					} else {
						// specific function call
						//alert("start");
						//console.log("inside second if");
						listplaylist.push(schedules.playlists[j].id);
					} */
					//console.log("numday == now.getUTCDay() || numday < now.getUTCDay()" + (numday == now.getUTCDay()) +"||"+ (numday < now.getUTCDay()));
					if(numday == now.getUTCDay() || numday > now.getUTCDay() ) {
						if(convertToTimeStamp(now.getUTCDay() , format) < convertToTimeStamp(numday, schedules.playlists[j].end.time)) {
							console.log("inside second if");
							listplaylist.push(schedules.playlists[j].id);
						} 
					}
				}
			}
		} catch (err){}
		//console.log(listplaylist);

}
function cleanListplaylist(){
	listplaylist.splice(0,listplaylist.length);
}
function cleanUp(){
	currentslide = "";
	currentmasterslide = "";
	document.getElementById("viewport").innerHTML = "";
	document.getElementById("prerender").innerHTML = "";
	document.getElementById("viewportmaster").innerHTML = "";
	document.getElementById("prerendermaster").innerHTML = "";

}
function cleanUpDefault(){
	cleanListplaylist();
	cleanUp();
	clearScreen();
}
function ucThreadNext() {
		ucArr.splice(0,1);
		setTimeout(ucThreadExec, 10);

}
function ucThreadExec(){
	ucExec = true;
	if(ucArr.length>0){console.log("calling runner");ucArr[0].runner();} else { console.log('ucThread end'); ucExec = false;}
}
function updateContent(data){
	console.log('uc : '+ ucArr.length + 'ucExec' + ucExec);
	ucArr[ucArr.length] = new updateContentClass(data);
	if(!ucExec){ucThreadExec();}
}

function scheduleCheckAndRun() {
    var now = new Date();
    var d = Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDay(),
        now.getUTCHours(), now.getUTCMinutes(), now.getUTCSeconds(), now.getUTCMilliseconds());
    var day = days[now.getUTCDay()].toLowerCase();
    var month = now.getUTCMonth() + 1;
    if (month < 10) {
        month = "0" + month;
    }
    var numday = now.getUTCDate();
    if (numday < 10) {
        numday = "0" + numday;
    }
    var hr = now.getUTCHours();
    var min = now.getUTCMinutes();
    if (min < 10) {
        min = "0" + min;
    }
    var sec = now.getUTCSeconds();
    if (sec < 10) {
        sec = "0" + sec;
    }
    //var ampm = hr < 12 ? "am" : "pm";
    //mmddyyyysec = (month) + '/' + numday + '/' + now.getUTCFullYear() + " " + hr + ":" + min + ":" + sec;
    //if (hr > 12) {
    //    hr = hr - 12;
    //}
    if (hr < 10) {
        hr = "0" + hr;
    }
    mmddyyyysec = (month) + '/' + numday + '/' + now.getUTCFullYear() + " " + hr + ":" + min + ":" + sec;


    var date = now.getUTCDate();
    //var format = hr + ":" + min + ":" + sec + " " + ampm;
	//console.log(override);
    console.log("mmddyyyysec == override.end" + mmddyyyysec + " == " + override.end + " mode: " + overridemode);
	if(override.playlistId && (Date.parse(mmddyyyysec) > Date.parse(override.end))){
		if(overridemode){
			//console.log("mmddyyyysec == override.end" + mmddyyyysec + " == " + override.end);
			clearTimeout(slideTimer);
			clearTimeout(effectTimer);
			currentplaylist = "";
			currentslide = "";
			overridemode = false;
			listplaystring = "";
			cleanListplaylist();
		}
		//override = "";
	}
    if (!(overridemode)) {
        refreshPlaylistArr();
        //console.log(listplaylist.toString() + "!=" + listplaystring);

        
		if(listplaylist.toString() != listplaystring) {
			if(listplaylist.length>0 ){
			//alert("changed schedule" + listplaylist.toString());
			listplaystring = listplaylist.toString();
			defaultmode = false;
			rotatePlArray();
		} else {
			currentplaylist = "";
		}
		listplaystring = listplaylist.toString();		
	} 
    }
	//console.log(currentplaylist);
    if (defaultpl.playlistId && currentplaylist.length < 1 && listplaystring.length < 1) {
        defaultmode = true;
		//alert("starting default");
        startPlayList(defaultpl.playlistId, 0);

    }
	
	if(!(defaultpl.playlistId) && currentplaylist.length < 1 && listplaystring.length < 1){
		clearScreen();
	
	}
    // exact ms to next minute interval
    setTimeout(scheduleCheckAndRun, 1000);
}

function startPlayList(pId, sc){
	//console.log("playlist: " + pId);
	playlists.get(pId, function(playJson) {
		//console.log(playJson);
		//console.log(playJson.slides.length);
		slideCounter=sc;
		clearTimeout(slideTimer);
		clearTimeout(effectTimer);
		if(playJson && playJson.slides){
			renderPlayList(playJson);
		} else {
			rotatePlArray();
		}
    });


}

function rotatePlArray(){
	//alert('rotate pl array');
	//console.log(listplaylist);
	//console.log(playlistcounter);
	startPlayList(listplaylist[playlistcounter], 0);
	playlistcounter++;
	if(listplaylist.length == playlistcounter){playlistcounter=0;}
}
function renderPlayList(playJson){
	//alert("render playlist");
	//console.log(playJson);
	clearTimeout(clearScreenTimer);
	clearTimeout(effectTimer);
	clearTimeout(slideTimer);
	currentplaylist=playJson.id;
	globalPlayJson = playJson;
	var effect = false;
	if(playJson.transitionMode){
		if(playJson.transitionMode == "fade-in-out"){
			effect = true;
		}
	}
	if(effect){
			effectTimer =setTimeout(function(){document.getElementById("viewport").className = "hidden";document.getElementById("viewportmaster").className = "hidden"; /*console.log('starting to hide');*/
			}, (playJson.slides[slideCounter].timing-2)*1000);

	}
	slides.get(playJson.slides[slideCounter].id, function(slideJson) {
		if(slideJson && slideJson.elements){
			renderSlide(playJson.slides[slideCounter].id, effect);
			var timing = playJson.slides[slideCounter].timing*1000;
			slideTimer=setTimeout(function(){renderPlayList(playJson);}, timing);
			slideCounter++;
			if(slideCounter==playJson.slides.length){
			slideCounter=0;
			// if schedule is playing with more number of playlists
				if(listplaylist.length>0){
					clearTimeout(slideTimer);
					slideTimer=setTimeout(function(){rotatePlArray();}, timing);
				}
			}

		} else {
			//alert("slide not found " + slideCounter);
			slideCounter++;
			if(slideCounter==playJson.slides.length){
				slideCounter=0; 
				if(listplaylist.length>0){
					rotatePlArray();
					return;
				} 
				 
				
			}
			renderPlayList(playJson);
		
		}
	});
}

function renderSlide(sId, effect){
	if(effect){
		document.getElementById("viewport").className = "hiddenimd";document.getElementById("viewportmaster").className = "hiddenimd";
	} else {
		document.getElementById("viewport").className = "visibleimd";document.getElementById("viewportmaster").className = "visibleimd";
	}
	slides.get(sId, function(slideJson) {
		if(slideJson && slideJson.elements){
			//console.log(slideJson);
			document.getElementById("prerender").innerHTML = "";
			// clear out video element array
			var aVideoElements = [];
			
			
			
			setOrientation(slideJson.isLandscape);
			for(i=0;i<slideJson.elements.length;i++){
				renderElements(slideJson.elements[i], 20, true, bNativeVideos ? aVideoElements : null);
			}
			looper("prerender");
			// looper waits for child elements to load
			function looper(cname){
				if(isLoaded(cname)){
					currentslide = sId;
					
					if(slideJson.masterSlideId){
						renderMSlide(slideJson.masterSlideId, true, effect, bNativeVideos ? aVideoElements : null);
					} else {
					    
						stopVideos();
	
						document.getElementById("viewport").innerHTML = "";
						document.getElementById("viewportmaster").innerHTML = "";
						var newParent = document.getElementById('viewport');
						var oldParent = document.getElementById('prerender');

						transferNodes(oldParent, newParent);
						
						makeVisisble(effect);
						document.getElementById('prerender').innerHTML = "";
						playVideos(aVideoElements);
						
						
						
					}
					return;
				} else {
					setTimeout(function (){looper(cname);} , 100);
				}
			}
			
		} else {stopVideos(); document.getElementById("viewport").innerHTML = "";	document.getElementById("viewportmaster").innerHTML = "";}
    });

}
function makeVisisble(effect){
	if(effect){
		document.getElementById("viewport").className = "visible"; 
		document.getElementById("viewportmaster").className = "visible"; 
		
	}

}
function isLoaded(cname){
	
	var getDivId = document.getElementById(cname);
    var images = getDivId.getElementsByTagName("img");
	var videos = getDivId.getElementsByTagName("video");
	
    for(var i=0; i<images.length; i++) {
        if(!IsImageOk(images[i])){return false;}
    }
    
	for(var i=0; i<videos.length; i++) {
        if(videos[i].readyState !=4 ){return false;}
    }
	
	return true;

}
function renderType(slideJson){
	console.log(slideJson.id);
	console.log(slideJson.masterSlideId);

}

function renderMSlide(sId, prerender, effect, aVideoElements){
	document.getElementById("prerendermaster").innerHTML = "";
	currentmasterslide = "";
	
	masterslides.get(sId, function(slideJson) {
	if(slideJson && slideJson.elements.length>0){
		//console.log(slideJson);
		for(i=0;i<slideJson.elements.length;i++){
			renderElements(slideJson.elements[i], 10, true, aVideoElements);
		}
			looper("prerendermaster");
			// looper waits for child elements to load
			function looper(cname){
				if(isLoaded(cname)){
					stopVideos();
					document.getElementById("viewport").innerHTML = "";
					document.getElementById("viewportmaster").innerHTML = "";
					currentmasterslide = sId;
					var newParent = document.getElementById('viewport');
					var oldParent = document.getElementById('prerender');

					transferNodes(oldParent, newParent);
					document.getElementById('prerender').innerHTML = "";
					
					newParent = document.getElementById('viewportmaster');
					oldParent = document.getElementById('prerendermaster');

					transferNodes(oldParent, newParent);
					
					playVideos(aVideoElements);
					makeVisisble(effect);
					document.getElementById("prerendermaster").innerHTML = "";
	
					return;
				} else {
					setTimeout(function (){looper(cname);} , 500);
				}
			}
		}
		
    });

	

}

function transferNodes(oldParent, newParent){

	newParent.innerHTML = oldParent.innerHTML;
	oldParent.innerHTML = "";
}
function stopVideos()
{
	if ( bNativeVideos) {
		Android.StopAllVideos();
	}
}
function playVideos(aVideoElements){


    if ( bNativeVideos) {
		try{
			Android.playAllVideos(JSON.stringify(aVideoElements));
		 } 
		 catch (err) {
		 //TODO bert add console output or?
		 }
	} else {
		var getDivId = document.getElementById('viewportmaster');
		var videos = getDivId.getElementsByTagName("video");
		
		for(var i=0; i<videos.length; i++) {
			videos[i].loop = true;
			videos[i].autoplay = true;
			videos[i].play();
			// specialVideoPlay function
			
		}

		
		getDivId = document.getElementById('viewport');
		videos = getDivId.getElementsByTagName("video");
		
		for(var i=0; i<videos.length; i++) {
			videos[i].loop = true;
			videos[i].autoplay = true;
			videos[i].play();
			// specialVideoPlay function
		}
	}
}

function renderElements(element, zi, prerender, aVideoElements){
	var cname;
	if(prerender & zi==10){ cname = "prerendermaster";}
	if(prerender & zi==20){ cname = "prerender";}
	
	if(!prerender & zi==10){ cname = "viewportmaster";}
	if(!prerender & zi==20){ cname = "viewport";}
	
	container = document.getElementById(cname);
	
	//console.log(element);
	//console.log(element.height);
	if(element.type=="image"){
		var DOM_img = document.createElement("img");
		DOM_img.src = element.source;
		DOM_img.style.left = element.left;
		DOM_img.style.top = element.top;
		DOM_img.style.width = element.width;
		DOM_img.style.height = element.height;
		DOM_img.style.position = "absolute";
		DOM_img.style.zIndex =  zi;
		container.appendChild(DOM_img);
	}
	if(element.type=="video"){
	
		if ( aVideoElements ) {
			aVideoElements.push(element);
		} else {
			var DOM_vid = document.createElement("video");
			DOM_vid.src = element.source;
			DOM_vid.style.left = element.left;
			DOM_vid.style.top = element.top;
			DOM_vid.style.width = element.width;
			DOM_vid.style.height = element.height;
			DOM_vid.style.position = "absolute";
			DOM_vid.style.zIndex =  zi;
			if(!prerender) {
				DOM_vid.autoplay = true;
				DOM_vid.loop = true;
			}
			container.appendChild(DOM_vid);
		}
		
	}
	if(element.type=="text"){
		var DOM_txt = document.createElement("div");
		DOM_txt.innerHTML = Encoder.htmlDecode(element.source);
		DOM_txt.style.left = element.left;
		DOM_txt.style.top = element.top;
		DOM_txt.style.width = element.width;
		DOM_txt.style.height = element.height;
		DOM_txt.style.zIndex =  zi;
		DOM_txt.style.position = "absolute";
		DOM_txt.style.fontSize = getFontSize();
		DOM_txt.className = "text-object";
		container.appendChild(DOM_txt);
	}
}

function clearScreen(){
    
	stopVideos();	
	document.getElementById("viewport").innerHTML = "";
	document.getElementById("viewportmaster").innerHTML = "";
	document.getElementById("prerender").innerHTML = "";
	document.getElementById("prerendermaster").innerHTML = "";
	currentslide = "";
	currentmasterslide = "";
	currentplaylist = "";
	container = document.getElementById("viewport");
	var DOM_txt = document.createElement("div");
		DOM_txt.id="nocontent";
		DOM_txt.innerHTML = "NO CONTENT";
		DOM_txt.style.left = getRandomArbitrary(0,80)+"%";
		DOM_txt.style.top = getRandomArbitrary(0,80)+"%";
		DOM_txt.style.width = "20%";
		DOM_txt.style.height = "20%";
		DOM_txt.style.zIndex =  "20";
		DOM_txt.style.position = "absolute";
		container.appendChild(DOM_txt);
		
		
	clearScreenTimer = setTimeout(displayNoContent, 2000);

}

function displayNoContent(){
    DOM_txt = document.getElementById("nocontent");
	DOM_txt.style.left = getRandomArbitrary(0,80)+"%";
	DOM_txt.style.top = getRandomArbitrary(0,80)+"%";
	clearScreenTimer = setTimeout(displayNoContent, 2000);

}
function convertToTimeStamp(day, timestr){
	return Date.parse('01/' + day + '/2000 '+ convertTo24Hour(timestr));
}

function convertTo24Hour(time) {
    var hours = parseInt(time.substr(0, 2));
    if(time.indexOf('am') != -1 && hours == 12) {
        time = time.replace('12', '0');
    }
    if(time.indexOf('pm')  != -1 && hours < 12) {
        time = time.replace(hours, (hours + 12));
    }
    return time.replace(/(am|pm)/, '');
}

function IsImageOk(img) {
    //console.log(img.complete + ":" + img.naturalWidth);
    if (!img.complete) {
        return false;
    }

    // However, they do have two very useful properties: naturalWidth and
    // naturalHeight. These give the true size of the image. If it failed
    // to load, either of these should be zero.

    if (typeof img.naturalWidth !== "undefined" && img.naturalWidth === 0) {
        return false;
    }

    // No other way of checking: assume it?s ok.
    return true;
}
function getRandomArbitrary(min, max) {
    return Math.random() * (max - min) + min;
}

$(document).ready(function () {
	topContainer = $('#topContainer');
	$(window).resize(afterBrowserResized);
	afterBrowserResized();
	
});

function afterBrowserResized() {
    CANVAS_WIDTH = $(window).width();
    CANVAS_HEIGHT = $(window).height();

    if (CANVAS_HEIGHT * CANVAS_ASPECT_RATIO > CANVAS_WIDTH) {
        CANVAS_HEIGHT = CANVAS_WIDTH / CANVAS_ASPECT_RATIO;
    } else {
        CANVAS_WIDTH = CANVAS_HEIGHT * CANVAS_ASPECT_RATIO;
    }

    $('.text-object').each(function() {
        $(this).css('font-size', getFontSize());
    });
}

function getFontSize() {
    var scaleFactor = CANVAS_HEIGHT * 100 / CANVAS_O_HEIGHT;
    return scaleFactor + '%';
}

function setOrientation(isLandscape) {

	if (!topContainer)
		return;

	$(topContainer).removeClass('rotate90');
	$(topContainer).removeClass('rotate180');
	$(topContainer).removeClass('rotate270');

	$(topContainer).height(CANVAS_HEIGHT);
	$(topContainer).width(CANVAS_WIDTH);
	
	$(topContainer).css('top', '0');
	$(topContainer).css('left', '0');

	if (!isLandscape && isFlipped) {
		$(topContainer).addClass('rotate270');

		$(topContainer).height(CANVAS_WIDTH);
		$(topContainer).width(CANVAS_HEIGHT);

		$(topContainer).css('top', $(topContainer).width() + 'px');

	} else if (!isLandscape && !isFlipped) {
		$(topContainer).addClass('rotate90');

		$(topContainer).height(CANVAS_WIDTH);
		$(topContainer).width(CANVAS_HEIGHT);

		$(topContainer).css('left', $(topContainer).height() + 'px');

	} else if (isLandscape && isFlipped)
		$(topContainer).addClass('rotate180');
}

function setIsFlipped(isIt) {
    isFlipped = isIt;
}

clearScreen();
/*
updateContent('{"type":"slide","id":12,"isLandscape":true,"elements":[{"type":"text","left":"11.079545454545455%","top":"28.956228956228955%","width":"80.82386363636364%","height":"39.225589225589225%","source":"&lt;span style=&quot;font-size: 1880%; color: rgb(0, 0, 128); font-family: sancreekregular; background-color: rgb(255, 165, 0);&quot;&gt;I am Slide 1&lt;\/span&gt;"}]}');

updateContent('{"type":"playlist","id":1,"transitionMode":"none","slides":[{"id":12,"timing":10}]}');

updateContent('{"type":"default","playlistId":1}');
updateContent('{"type":"slide","id":9,"isLandscape":true,"elements":[{"type":"text","left":"11.079545454545455%","top":"28.956228956228955%","width":"80.82386363636364%","height":"39.225589225589225%","source":"&lt;span style=&quot;font-size: 1880%; color: rgb(0, 0, 128); font-family: sancreekregular; background-color: rgb(255, 165, 0);&quot;&gt;I am Slide 3&lt;\/span&gt;"}]}');
updateContent('{"type":"slide","id":9,"isLandscape":true,"elements":[{"type":"text","left":"11.711172624067826%","top":"22.306397306397326%","width":"71.51231476754853%","height":"55.55555555555556%","source":"&lt;span style=&quot;font-size: 1880%; color: rgb(0, 0, 128); font-family: sancreekregular; background-color: rgb(255, 165, 0);&quot;&gt;I am Slide 2&lt;\/span&gt;"}]}');
updateContent('{"type":"playlist","id":2,"transitionMode":"none","slides":[{"id":9,"timing":9}]}');
updateContent('{"type":"default","playlistId":2}');

//setTimeout(function() {updateContent('{"type":"playlist","id":3,"transitionMode":"none","slides":[{"id":9,"timing":9}]}')}, 2000);
//setTimeout(function() {updateContent('{"type":"default","playlistId":3}')}, 2000)




updateContent('{"type":"playlist","id":1}');


updateContent('{"type":"slide","id":12}');
updateContent('{"type":"slide","id":12,"isLandscape":true,"elements":[{"type":"text","left":"11.079545454545455%","top":"28.956228956228955%","width":"80.82386363636364%","height":"39.225589225589225%","source":"&lt;span style=&quot;font-size: 1880%; color: rgb(0, 0, 128); font-family: sancreekregular; background-color: rgb(255, 165, 0);&quot;&gt;I am Slide 1&lt;\/span&gt;"}]}');

updateContent('{"type":"playlist","id":1,"transitionMode":"none","slides":[{"id":12,"timing":10}]}');

updateContent('{"type":"default","playlistId":1}');
*/

/*
updateContent('{type: "playlist",id: 12312,"transitionMode": "fade-in-out", "slides":[	{"id": 46732, "timing": 6},{"id": 234,"timing": 6}, {"id": 34,"timing": 12}]}');
updateContent('{type: "playlist",id: 123,"transitionMode": "fade-in-out", "slides":[	{"id": 34,"timing": 5}, {"id": 46732,"timing": 5}]}');

updateContent('{"type": "slide","isLandscape":false,"id": 46732,"masterSlideId": 27,"elements":[{"type": "text","left": "28.598484848484848%","top": "17.171717171717173%",		"width": "28.645833333333332%",	"height": "8.577441077441078%",	"source": "SLIDE this will be an encoded HTML </br>SLIDEID: 46732"},{"type": "image","left": "15.340909090909092%",	"top": "30.134680134680135%","width": "46.515151515151516%","height": "47.138047138047135%","source": "DSCF3352_2.jpg"},{"type": "video","left":"33.90151515151515%","top": "33.333333333333336%","width": "46.041666666666668%","height": "47.77777777777778%","source": "example.mp4"}]}');
updateContent('{"type": "slide","id": 234,"isLandscape":false,"masterSlideId": 27,"elements":[{"type": "text","left": "28.598484848484848%","top": "17.171717171717173%",		"width": "28.645833333333332%",	"height": "8.577441077441078%",	"source": "slide 234"},{"type": "image","left": "15.340909090909092%",	"top": "30.134680134680135%","width": "46.515151515151516%","height": "47.138047138047135%","source": "DSCF3352_2.jpg"},{"type": "video","left":"3.90151515151515%","top": "3.333333333333336%","width": "76.041666666666668%","height": "77.77777777777778%","source": "example.mp4"}]}');
updateContent('{"type": "slide","isLandscape":true,"id": 34,"elements":[{"type": "text","left": "8.598484848484848%","top": "7.171717171717173%",		"width": "28.645833333333332%",	"height": "8.577441077441078%",	"source": "&lt;span style=&quot;font-size: 680%; color: rgb(0, 0, 128); font-family: sancreekregular; background-color: rgb(255, 0, 0);&quot;&gt;San Creek&lt;/span&gt;"},{"type": "image","left": "15.340909090909092%",	"top": "30.134680134680135%","width": "46.515151515151516%","height": "47.138047138047135%","source": "DSCF3352_2.jpg"}]}');

updateContent('{"type": "master-slide","id": 27,"elements":[{"type": "text","left": "18.598484848484848%","top": "7.171717171717173%",	"width":"28.645833333333332%","height": "8.577441077441078%","source": "<b>MASTER SLIDE</b> content"},{"type": "image","left": "15.340909090909092%",		"top": "30.134680134680135%","width": "26.515151515151516%","height": "47.138047138047135%","source": "DSCF3300.JPG"},{"type": "image","left": "15.340909090909092%",		"top": "60.134680134680135%","width": "26.515151515151516%","height": "47.138047138047135%","source": "DSCF3300.JPG"},{"type": "image","left": "40.340909090909092%",		"top": "30.134680134680135%","width": "26.515151515151516%","height": "47.138047138047135%","source": "DSCF3352_2.jpg"},{"type": "video","left":"0.90151515151515%","top": "33.333333333333336%","width": "26.041666666666668%","height": "27.77777777777778%","source": "example.mp4"}]}');

updateContent('{"type":"slide","id":1,"isLandscape":true,"elements":[{"type":"text","left":"20.201704718849875%","top":"35.72895550968671%","width":"28.645833333333332%","height":"6.565656565656566%","source":"&lt;span style=&quot;color: rgb(255, 255, 255); font-family: eraserregular; font-size: 440%;&quot;&gt;S1&lt;/span&gt;"},{"type":"text","left":"9.469696969696969%","top":"12.962962962962964%","width":"28.645833333333332%","height":"14.141414141414142%","source":"&lt;span style=&quot;font-size: 680%; color: rgb(0, 0, 128); font-family: sancreekregular; background-color: rgb(255, 0, 0);&quot;&gt;San Creek&lt;/span&gt;"}]}');
updateContent('{"type":"slide","id":2,"isLandscape":true,"elements":[{"type":"text","left":"20.201704718849875%","top":"35.72895550968671%","width":"28.645833333333332%","height":"6.565656565656566%","source":"&lt;span style=&quot;color: rgb(255, 255, 255); font-family: eraserregular; font-size: 440%;&quot;&gt;S1&lt;/span&gt;"},{"type":"text","left":"9.469696969696969%","top":"12.962962962962964%","width":"28.645833333333332%","height":"14.141414141414142%","source":"&lt;span style=&quot;font-size: 680%; color: rgb(0, 0, 128); font-family: sancreekregular; background-color: rgb(255, 0, 0);&quot;&gt;Slide2&lt;/span&gt;"}]}');


updateContent('{"type":"default","playlistId":123}');

setTimeout(function() {updateContent('{"type": "slide","isLandscape":false,"id": 46732,"masterSlideId": 27}');}, 7000);



updateContent('{"type": "slide","isLandscape":true,"id": 134,"elements":[{"type": "text","left": "18.598484848484848%","top": "7.171717171717173%", "width": "28.645833333333332%", "height": "8.577441077441078%", "source": "&lt;span style=&quot;font-size: 680%; color: rgb(0, 0, 128); font-family: sancreekregular; background-color: rgb(255, 0, 0);&quot;&gt;Slide 134&lt;/span&gt;"},{"type": "image","left": "15.340909090909092%", "top": "30.134680134680135%","width": "46.515151515151516%","height": "47.138047138047135%","source": "DSCF3352_2.jpg"}]}');

updateContent('{"type": "slide","isLandscape":true,"id": 135,"elements":[{"type": "text","left": "18.598484848484848%","top": "7.171717171717173%", "width": "28.645833333333332%", "height": "8.577441077441078%", "source": "&lt;span style=&quot;font-size: 680%; color: rgb(0, 0, 128); font-family: sancreekregular; background-color: rgb(255, 0, 0);&quot;&gt;Slide 135&lt;/span&gt;"},{"type": "image","left": "15.340909090909092%", "top": "30.134680134680135%","width": "46.515151515151516%","height": "47.138047138047135%","source": "DSCF3352_2.jpg"}]}');

updateContent('{"type": "slide","isLandscape":true,"id": 136,"elements":[{"type": "text","left": "18.598484848484848%","top": "7.171717171717173%", "width": "28.645833333333332%", "height": "8.577441077441078%", "source": "&lt;span style=&quot;font-size: 680%; color: rgb(0, 0, 128); font-family: sancreekregular; background-color: rgb(255, 0, 0);&quot;&gt;Slide 136&lt;/span&gt;"},{"type": "image","left": "15.340909090909092%", "top": "30.134680134680135%","width": "46.515151515151516%","height": "47.138047138047135%","source": "DSCF3352_2.jpg"}]}');

updateContent('{"type": "slide","isLandscape":true,"id": 137,"elements":[{"type": "text","left": "18.598484848484848%","top": "7.171717171717173%", "width": "28.645833333333332%", "height": "8.577441077441078%", "source": "&lt;span style=&quot;font-size: 680%; color: rgb(0, 0, 128); font-family: sancreekregular; background-color: rgb(255, 0, 0);&quot;&gt;Slide 137&lt;/span&gt;"},{"type": "image","left": "15.340909090909092%", "top": "30.134680134680135%","width": "46.515151515151516%","height": "47.138047138047135%","source": "DSCF3352_2.jpg"}]}');



updateContent('{type: "playlist",id: 1111,"transitionMode": "fade-in-out", "slides":[ {"id": 136,"timing": 5},{"id": 137,"timing": 5} ]}');

updateContent('{type: "playlist",id: 2222,"transitionMode": "fade-in-out", "slides":[ {"id": 134,"timing": 5},{"id": 135,"timing": 5} ]}');





updateContent('{"type":"default","playlistId":1111}');

*/

updateContent('{"type": "master-slide","id": 27,"elements":[{"type": "text","left": "18.598484848484848%","top": "7.171717171717173%",	"width":"28.645833333333332%","height": "8.577441077441078%","source": "<b>MASTER SLIDE</b> content"},{"type": "image","left": "15.340909090909092%",		"top": "30.134680134680135%","width": "26.515151515151516%","height": "47.138047138047135%","source": "DSCF3300.JPG"},{"type": "image","left": "15.340909090909092%",		"top": "60.134680134680135%","width": "26.515151515151516%","height": "47.138047138047135%","source": "DSCF3300.JPG"},{"type": "image","left": "40.340909090909092%",		"top": "30.134680134680135%","width": "26.515151515151516%","height": "47.138047138047135%","source": "DSCF3352_2.jpg"},{"type": "video","left":"0.90151515151515%","top": "33.333333333333336%","width": "26.041666666666668%","height": "27.77777777777778%","source": "example.mp4"}]}');
updateContent('{"type": "slide","id": 234,"isLandscape":true,"masterSlideId": 27,"elements":[{"type": "text","left": "28.598484848484848%","top": "17.171717171717173%",		"width": "28.645833333333332%",	"height": "8.577441077441078%",	"source": "slide 234"},{"type": "image","left": "15.340909090909092%",	"top": "30.134680134680135%","width": "46.515151515151516%","height": "47.138047138047135%","source": "DSCF3352_2.jpg"},{"type": "video","left":"3.90151515151515%","top": "3.333333333333336%","width": "76.041666666666668%","height": "77.77777777777778%","source": "example.mp4"}]}');


updateContent('{"type": "slide","isLandscape":true,"id": 134,"elements":[{"type": "text","left": "18.598484848484848%","top": "7.171717171717173%", "width": "28.645833333333332%", "height": "8.577441077441078%", "source": "&lt;span style=&quot;font-size: 680%; color: rgb(0, 0, 128); font-family: sancreekregular; background-color: rgb(255, 0, 0);&quot;&gt;Slide 134&lt;/span&gt;"},{"type": "image","left": "15.340909090909092%", "top": "30.134680134680135%","width": "46.515151515151516%","height": "47.138047138047135%","source": "DSCF3352_2.jpg"}]}');

updateContent('{"type": "slide","isLandscape":true,"id": 135,"elements":[{"type": "text","left": "18.598484848484848%","top": "7.171717171717173%", "width": "28.645833333333332%", "height": "8.577441077441078%", "source": "&lt;span style=&quot;font-size: 680%; color: rgb(0, 0, 128); font-family: sancreekregular; background-color: rgb(255, 0, 0);&quot;&gt;Slide 135&lt;/span&gt;"},{"type": "image","left": "15.340909090909092%", "top": "30.134680134680135%","width": "46.515151515151516%","height": "47.138047138047135%","source": "DSCF3352_2.jpg"}]}');

updateContent('{"type": "slide","isLandscape":true,"id": 136,"elements":[{"type": "text","left": "18.598484848484848%","top": "7.171717171717173%", "width": "28.645833333333332%", "height": "8.577441077441078%", "source": "&lt;span style=&quot;font-size: 680%; color: rgb(0, 0, 128); font-family: sancreekregular; background-color: rgb(255, 0, 0);&quot;&gt;Slide 136&lt;/span&gt;"},{"type": "image","left": "15.340909090909092%", "top": "30.134680134680135%","width": "46.515151515151516%","height": "47.138047138047135%","source": "DSCF3352_2.jpg"}]}');

updateContent('{"type": "slide","isLandscape":true,"id": 137,"elements":[{"type": "text","left": "18.598484848484848%","top": "7.171717171717173%", "width": "28.645833333333332%", "height": "8.577441077441078%", "source": "&lt;span style=&quot;font-size: 680%; color: rgb(0, 0, 128); font-family: sancreekregular; background-color: rgb(255, 0, 0);&quot;&gt;Slide 137&lt;/span&gt;"},{"type": "image","left": "15.340909090909092%", "top": "30.134680134680135%","width": "46.515151515151516%","height": "47.138047138047135%","source": "DSCF3352_2.jpg"}]}');



updateContent('{type: "playlist",id: 1111,"transitionMode": "fade-in-out", "slides":[ {"id": 234,"timing": 5}, {"id": 136,"timing": 5},{"id": 137,"timing": 5} ]}');

updateContent('{type: "playlist",id: 2222,"transitionMode": "fade-in-out", "slides":[ {"id": 134,"timing": 5},{"id": 135,"timing": 5} ]}');




updateContent('{type: "playlist",id: 12345,"transitionMode": "fade-in-out", "slides":[ {"id": 119,"timing": 150} ]}');


updateContent('{"type":"default","playlistId":1111}');
updateContent('{"type":"default","playlistId":12345}');

updateContent('{"type":"slide","id":119,"isLandscape":false,"elements":[{"type":"video","left":"0.411522633744856%","top":"-0.05208333333333202%","width":"99.7942386831276%","height":"33.68055555555558%","source":"vid1.mp4","play":"once"},{"type":"video","left":"0.411522633744856%","top":"36.23842592592593%","width":"99.7942386831276%","height":"33.68055555555558%","source":"vid2.mp4","play":"once"},{"type":"text","left":"31.893004115226336%","top":"32.75462962962962%","width":"50.925925925925924%","height":"4.137731481481482%","source":"&lt;span style=&quot;font-size: 400%; color: rgb(0, 0, 0); font-family: sancreekregular;&quot;&gt;AudioWide&lt;/span&gt;"},{"type":"text","left":"3.4979423868312756%","top":"0.9259259259259259%","width":"50.925925925925924%","height":"6.377314814814815%","source":"&lt;span style=&quot;font-size: 640%; color: rgb(0, 0, 0); font-family: sancreekregular;&quot;&gt;cinzel&lt;/span&gt;"}]}');
updateContent('{"type":"slide","id":119,"isLandscape":false,"elements":[{"type":"text","left":"3.4979423868312756%","top":"0.9259259259259259%","width":"50.925925925925924%","height":"6.377314814814815%","source":"&lt;span style=&quot;font-size: 640%; color: rgb(0, 0, 0); font-family: sancreekregular;&quot;&gt;cinzel&lt;/span&gt;"},{"type":"video","left":"0.411522633744856%","top":"-0.05208333333333202%","width":"99.7942386831276%","height":"33.68055555555558%","source":"vid1.mp4","play":"once"},{"type":"video","left":"0.411522633744856%","top":"36.23842592592593%","width":"99.7942386831276%","height":"33.68055555555558%","source":"vid2.mp4","play":"once"},{"type":"text","left":"31.893004115226336%","top":"32.75462962962962%","width":"50.925925925925924%","height":"4.137731481481482%","source":"&lt;span style=&quot;font-size: 400%; color: rgb(0, 0, 0); font-family: sancreekregular;&quot;&gt;AudioWide&lt;/span&gt;"}]}');



setTimeout(function() {

//updateContent('{"type": "override","playlistId": 2222,"end": "10/20/2015 05:09:00"}');



},5000

);

scheduleCheckAndRun();


</script>

</body>
</html>
